<!-- Medici√≥n y M√©tricas Section -->
<section id="metricas" class="section">
    <div class="container">
        <div class="section-header reveal">
            <h2 class="section-title">Medici√≥n & M√©tricas</h2>
            <p class="section-subtitle">C√≥mo medimos el √©xito y el progreso del equipo en SCRUM</p>
        </div>

        <!-- üîß CONCEPTOS CORREGIDOS -->
        <div class="grid grid-3 reveal">
            <div class="card">
                <div class="card-icon">üìä</div>
                <h3 class="card-title">Story Points</h3>
                <p class="card-text">
                    <strong>Definici√≥n:</strong> Medida relativa del <em>tama√±o</em> de una User Story basada en complejidad, incertidumbre y esfuerzo.<br><br>
                    <strong>Escala Fibonacci:</strong> 1, 2, 3, 5, 8, 13, 21<br><br>
                    <strong>Planning Poker:</strong> T√©cnica de estimaci√≥n colaborativa donde cada miembro del Developers vota.<br><br>
                    <strong>Clave:</strong> Relatividad, no medida absoluta de tiempo
                </p>
                
                <!-- üîß ACLARACI√ìN CONCEPTUAL -->
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(99, 102, 241, 0.1); border-radius: 10px; border-left: 3px solid var(--primary);">
                    <p style="color: var(--light); margin: 0; font-size: 0.9rem;">
                        <strong>üìñ Marco Te√≥rico:</strong> Los SP representan el "tama√±o relativo" percibido por el equipo, 
                        no horas exactas. Una User Story de 8 SP es ~4x m√°s compleja que una de 2 SP.
                    </p>
                </div>
            </div>

            <div class="card">
                <div class="card-icon">üí∞</div>
                <h3 class="card-title">Business Value</h3>
                <p class="card-text">
                    <strong>Definici√≥n:</strong> Valor cuantificado que una User Story aporta al negocio o usuario final.<br><br>
                    <strong>Escala:</strong> Fibonacci (1-34) o escala personalizada<br><br>
                    <strong>Owner:</strong> Product Owner determina y asigna el valor<br><br>
                    <strong>Uso:</strong> Priorizaci√≥n del Product Backlog por ROI
                </p>
                
                <!-- üîß NOTA SOBRE WSJF -->
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(236, 72, 153, 0.1); border-radius: 10px; border-left: 3px solid var(--secondary);">
                    <p style="color: var(--light); margin: 0; font-size: 0.9rem;">
                        <strong>üìã Extensi√≥n SAFe:</strong> WSJF (Weighted Shortest Job First) es una t√©cnica de 
                        <em>Scaled Agile Framework</em>, no parte del SCRUM oficial. √ötil para priorizaci√≥n avanzada.
                    </p>
                </div>
            </div>

            <div class="card">
                <div class="card-icon">üöÄ</div>
                <h3 class="card-title">Velocity</h3>
                <p class="card-text">
                    <strong>Definici√≥n:</strong> Cantidad de Story Points completados por el equipo en un Sprint.<br><br>
                    <strong>Uso correcto:</strong> Herramienta de planificaci√≥n interna del equipo<br><br>
                    <strong>C√°lculo:</strong> Suma de SP de User Stories "Done" al final del Sprint
                </p>
                
                <!-- üîß ACLARACI√ìN CONCEPTUAL CR√çTICA -->
                <div style="margin-top: 1rem; padding: 1.5rem; background: rgba(239, 68, 68, 0.1); border-radius: 10px; border-left: 3px solid #EF4444;">
                    <h6 style="color: #EF4444; margin-bottom: 1rem;">‚ö†Ô∏è Velocity NO es:</h6>
                    <ul style="color: var(--gray); list-style: none; padding: 0; font-size: 0.9rem;">
                        <li style="margin-bottom: 0.5rem;">‚ùå M√©trica de productividad del equipo</li>
                        <li style="margin-bottom: 0.5rem;">‚ùå Comparable entre equipos diferentes</li>
                        <li style="margin-bottom: 0.5rem;">‚ùå Indicador de calidad del trabajo</li>
                        <li style="margin-bottom: 0.5rem;">‚ùå Meta a maximizar constantemente</li>
                        <li>‚ùå Herramienta de evaluaci√≥n de performance</li>
                    </ul>
                </div>
                
                <div style="margin-top: 1rem; padding: 1.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 10px; border-left: 3px solid var(--accent);">
                    <h6 style="color: var(--accent); margin-bottom: 1rem;">‚úÖ Velocity S√ç es:</h6>
                    <ul style="color: var(--gray); list-style: none; padding: 0; font-size: 0.9rem;">
                        <li style="margin-bottom: 0.5rem;">‚úÖ Herramienta de planificaci√≥n del Sprint</li>
                        <li style="margin-bottom: 0.5rem;">‚úÖ Indicador de capacidad hist√≥rica del equipo</li>
                        <li style="margin-bottom: 0.5rem;">‚úÖ Ayuda para forecasting de releases</li>
                        <li style="margin-bottom: 0.5rem;">‚úÖ M√©trica interna para auto-organizaci√≥n</li>
                        <li>‚úÖ Base para inspect & adapt del proceso</li>
                    </ul>
                </div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(99, 102, 241, 0.1); border-radius: 10px;">
                    <p style="color: var(--light); margin: 0; font-size: 0.9rem;">
                        <strong>üìä Uso correcto:</strong> Analizar tendencias en 3-5 Sprints para entender la capacidad del equipo. 
                        Una velocity estable indica madurez del equipo, no necesariamente mayor productividad.
                    </p>
                </div>
            </div>
        </div>

        <!-- üîß NUEVA SECCI√ìN: C√°lculo Correcto de Velocity -->
        <div class="example-container reveal" style="margin-top: 3rem;">
            <div class="example-header">
                <h3 style="font-size: 1.8rem; margin-bottom: 1rem;">üìà C√°lculo Correcto de Velocity</h3>
                <p style="color: var(--gray);">An√°lisis contextual vs promedio simple</p>
            </div>

            <div class="example-tabs">
                <button class="tab-button active" data-tab="velocity-correcto">M√©todo Correcto</button>
                <button class="tab-button" data-tab="velocity-incorrecto">Errores Comunes</button>
                <button class="tab-button" data-tab="velocity-contexto">Factores Contextuales</button>
            </div>

            <div class="tab-content active" id="velocity-correcto">
                <div style="padding: 2rem; background: rgba(30, 41, 59, 0.5); border-radius: 15px;">
                    <h4 style="color: var(--primary); margin-bottom: 1.5rem;">‚úÖ An√°lisis Contextual de Velocity</h4>
                    
                    <div style="background: rgba(99, 102, 241, 0.1); padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;">
                        <h5 style="color: var(--primary); margin-bottom: 1rem;">Ejemplo: Equipo "Thunder" - √öltimos 6 Sprints</h5>
                        <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 1rem; margin-bottom: 1rem;">
                            <div style="text-align: center; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">32</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">Sprint 1</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">28</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">Sprint 2</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">45</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">Sprint 3</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">41</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">Sprint 4</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">38</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">Sprint 5</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">42</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">Sprint 6</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div style="padding: 1.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 10px;">
                            <h6 style="color: var(--accent); margin-bottom: 1rem;">üìä An√°lisis Correcto</h6>
                            <ul style="color: var(--gray); list-style: none; padding: 0; font-size: 0.9rem;">
                                <li style="margin-bottom: 0.8rem;">üìà <strong>Tendencia:</strong> Estabilizaci√≥n en ~40 SP</li>
                                <li style="margin-bottom: 0.8rem;">üéØ <strong>Rango esperado:</strong> 35-45 SP</li>
                                <li style="margin-bottom: 0.8rem;">‚ö†Ô∏è <strong>Sprint 2:</strong> Investigar causa (vacaciones, incidentes)</li>
                                <li style="margin-bottom: 0.8rem;">‚úÖ <strong>Sprint 3:</strong> Pico por catch-up</li>
                                <li>üîÆ <strong>Predicci√≥n:</strong> 38-42 SP para pr√≥ximo Sprint</li>
                            </ul>
                        </div>
                        
                        <div style="padding: 1.5rem; background: rgba(239, 68, 68, 0.1); border-radius: 10px;">
                            <h6 style="color: #EF4444; margin-bottom: 1rem;">‚ùå Promedio Simple (Incorrecto)</h6>
                            <div style="color: var(--gray); font-size: 0.9rem;">
                                <p style="margin-bottom: 1rem;">
                                    (32+28+45+41+38+42) √∑ 6 = <strong>37.7 SP</strong>
                                </p>
                                <p style="margin-bottom: 1rem; color: #EF4444;">
                                    ‚ùå <strong>Problemas:</strong>
                                </p>
                                <ul style="list-style: none; padding: 0;">
                                    <li style="margin-bottom: 0.6rem;">‚Ä¢ Ignora tendencia ascendente</li>
                                    <li style="margin-bottom: 0.6rem;">‚Ä¢ No considera contexto de outliers</li>
                                    <li style="margin-bottom: 0.6rem;">‚Ä¢ Subestima capacidad actual</li>
                                    <li>‚Ä¢ No identifica patrones estacionales</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="velocity-incorrecto">
                <div style="padding: 2rem; background: rgba(30, 41, 59, 0.5); border-radius: 15px;">
                    <h4 style="color: #EF4444; margin-bottom: 1.5rem;">‚ùå Anti-Patrones Comunes</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr; gap: 1.5rem;">
                        <div style="padding: 1.5rem; background: rgba(239, 68, 68, 0.1); border-radius: 10px; border-left: 4px solid #EF4444;">
                            <h5 style="color: #EF4444; margin-bottom: 1rem;">üö´ Velocity como M√©trica de Performance</h5>
                            <p style="color: var(--gray); margin: 0;">
                                <strong>Error:</strong> "El equipo A tiene velocity 50, el equipo B tiene 30, A es m√°s productivo"<br>
                                <strong>Realidad:</strong> Equipos diferentes, contextos diferentes, escalas de estimaci√≥n diferentes.
                            </p>
                        </div>
                        
                        <div style="padding: 1.5rem; background: rgba(239, 68, 68, 0.1); border-radius: 10px; border-left: 4px solid #EF4444;">
                            <h5 style="color: #EF4444; margin-bottom: 1rem;">üö´ Presi√≥n por Aumentar Velocity</h5>
                            <p style="color: var(--gray); margin: 0;">
                                <strong>Error:</strong> "Este sprint tienen que hacer 50 SP, el anterior fueron 45"<br>
                                <strong>Consecuencia:</strong> Inflaci√≥n artificial de estimaciones o burnout del equipo.
                            </p>
                        </div>
                        
                        <div style="padding: 1.5rem; background: rgba(239, 68, 68, 0.1); border-radius: 10px; border-left: 4px solid #EF4444;">
                            <h5 style="color: #EF4444; margin-bottom: 1rem;">üö´ Ignorar Contexto en el C√°lculo</h5>
                            <p style="color: var(--gray); margin: 0;">
                                <strong>Error:</strong> Incluir sprints con cambios significativos del equipo en el promedio<br>
                                <strong>Mejor:</strong> Reiniciar tracking de velocity tras cambios estructurales.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="velocity-contexto">
                <div style="padding: 2rem; background: rgba(30, 41, 59, 0.5); border-radius: 15px;">
                    <h4 style="color: var(--accent); margin-bottom: 1.5rem;">üéØ Factores que Afectan Velocity</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <h5 style="color: var(--accent); margin-bottom: 1rem;">üë• Factores del Equipo</h5>
                            <ul style="color: var(--gray); list-style: none; padding: 0; font-size: 0.9rem;">
                                <li style="margin-bottom: 0.8rem;">‚Ä¢ <strong>Cambios de miembros:</strong> Reiniciar medici√≥n</li>
                                <li style="margin-bottom: 0.8rem;">‚Ä¢ <strong>Skill level:</strong> Mejorar con experiencia</li>
                                <li style="margin-bottom: 0.8rem;">‚Ä¢ <strong>Colaboraci√≥n:</strong> Tuckman stages (forming ‚Üí performing)</li>
                                <li style="margin-bottom: 0.8rem;">‚Ä¢ <strong>Vacaciones/ausencias:</strong> Ajustar expectativas</li>
                                <li>‚Ä¢ <strong>Learning curve:</strong> Nueva tecnolog√≠a/dominio</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h5 style="color: var(--accent); margin-bottom: 1rem;">üõ†Ô∏è Factores T√©cnicos</h5>
                            <ul style="color: var(--gray); list-style: none; padding: 0; font-size: 0.9rem;">
                                <li style="margin-bottom: 0.8rem;">‚Ä¢ <strong>Technical debt:</strong> Reduce velocity temporalmente</li>
                                <li style="margin-bottom: 0.8rem;">‚Ä¢ <strong>Infrastructure:</strong> Setup CI/CD, entornos</li>
                                <li style="margin-bottom: 0.8rem;">‚Ä¢ <strong>Dependencies:</strong> Equipos externos, APIs</li>
                                <li style="margin-bottom: 0.8rem;">‚Ä¢ <strong>Definition of Done:</strong> Cambios en criterios</li>
                                <li>‚Ä¢ <strong>Legacy systems:</strong> Complejidad adicional</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(99, 102, 241, 0.1); border-radius: 10px;">
                        <h6 style="color: var(--primary); margin-bottom: 1rem;">üéØ Recomendaci√≥n de C√°lculo</h6>
                        <p style="color: var(--light); margin: 0;">
                            Usar los <strong>√∫ltimos 3-4 sprints</strong> con contexto estable. Si hay cambios significativos, 
                            considerar solo sprints post-cambio. Incluir an√°lisis de tendencias y outliers, no solo promedios.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- WSJF Calculator - Con aclaraci√≥n de que es extensi√≥n SAFe -->
        <div class="example-container reveal">
            <div class="example-header">
                <h3 style="font-size: 2rem; margin-bottom: 1rem;">Calculadora WSJF</h3>
                <p style="color: var(--gray);">Weighted Shortest Job First - <strong>T√©cnica de SAFe para priorizaci√≥n avanzada</strong></p>
                
                <!-- üîß ACLARACI√ìN SAFe -->
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(236, 72, 153, 0.1); border-radius: 10px; border-left: 3px solid var(--secondary);">
                    <p style="color: var(--light); margin: 0; font-size: 0.9rem;">
                        <strong>üìã Contexto:</strong> WSJF es una t√©cnica del <em>Scaled Agile Framework (SAFe)</em>, 
                        no parte del marco SCRUM oficial. Es √∫til para equipos que necesitan priorizaci√≥n cuantitativa avanzada.
                    </p>
                </div>
            </div>

            <div style="background: rgba(30, 41, 59, 0.5); border-radius: 15px; padding: 2rem;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                    <div style="text-align: center;">
                        <label style="display: block; color: var(--accent); margin-bottom: 0.5rem;">üí∞ Business Value</label>
                        <input type="range" id="businessValue" min="1" max="21" value="8" style="width: 100%; margin-bottom: 0.5rem;">
                        <div style="color: var(--primary); font-weight: bold;" id="businessValueDisplay">8</div>
                    </div>
                    <div style="text-align: center;">
                        <label style="display: block; color: var(--accent); margin-bottom: 0.5rem;">‚è∞ Urgencia</label>
                        <input type="range" id="urgency" min="1" max="21" value="5" style="width: 100%; margin-bottom: 0.5rem;">
                        <div style="color: var(--primary); font-weight: bold;" id="urgencyDisplay">5</div>
                    </div>
                    <div style="text-align: center;">
                        <label style="display: block; color: var(--accent); margin-bottom: 0.5rem;">üõ°Ô∏è Reducci√≥n Riesgo</label>
                        <input type="range" id="riskReduction" min="1" max="21" value="3" style="width: 100%; margin-bottom: 0.5rem;">
                        <div style="color: var(--primary); font-weight: bold;" id="riskReductionDisplay">3</div>
                    </div>
                    <div style="text-align: center;">
                        <label style="display: block; color: var(--warning); margin-bottom: 0.5rem;">üéØ Esfuerzo (SP)</label>
                        <input type="range" id="effort" min="1" max="21" value="8" style="width: 100%; margin-bottom: 0.5rem;">
                        <div style="color: var(--warning); font-weight: bold;" id="effortDisplay">8</div>
                    </div>
                </div>
                
                <div style="padding: 2rem; background: rgba(99, 102, 241, 0.1); border-radius: 15px;">
                    <h5 style="color: var(--primary); margin-bottom: 1rem;">üßÆ Resultado WSJF</h5>
                    
                    <div style="text-align: center; padding: 2rem; background: rgba(30, 41, 59, 0.5); border-radius: 10px; margin-bottom: 1.5rem;">
                        <div style="font-size: 3rem; font-weight: bold; color: var(--primary);" id="wsjfResult">2.0</div>
                        <div style="color: var(--gray); margin-top: 0.5rem;">Score WSJF</div>
                    </div>
                    
                    <div style="background: rgba(30, 41, 59, 0.3); padding: 1.5rem; border-radius: 10px;">
                        <h6 style="color: var(--accent); margin-bottom: 1rem;">F√≥rmula:</h6>
                        <p style="color: var(--gray); font-family: monospace; text-align: center;">
                            WSJF = (<span id="formulaBV">8</span> + <span id="formulaU">5</span> + <span id="formulaRR">3</span>) / <span id="formulaE">8</span>
                        </p>
                        <p style="color: var(--gray); font-family: monospace; text-align: center; margin-top: 1rem;">
                            WSJF = <span id="formulaSum">16</span> / <span id="formulaEffort">8</span> = <span id="formulaResult">2.0</span>
                        </p>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 10px;">
                        <h6 style="color: var(--accent); margin-bottom: 0.5rem;">üí° Interpretaci√≥n:</h6>
                        <p style="color: var(--gray); margin: 0;" id="wsjfInterpretation">Prioridad media - Considerar para pr√≥ximos sprints</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-2 reveal">
            <div class="chart-container">
                <h3 class="chart-title">Burndown Chart</h3>
                <canvas id="burndownChart"></canvas>
                <p style="color: var(--gray); font-size: 0.9rem; margin-top: 1rem;">
                    Tendencia de trabajo restante vs tiempo ideal del Sprint
                </p>
            </div>
            <div class="chart-container">
                <h3 class="chart-title">Velocity Trend</h3>
                <canvas id="velocityChart"></canvas>
                <p style="color: var(--gray); font-size: 0.9rem; margin-top: 1rem;">
                    Evoluci√≥n de velocity con an√°lisis de tendencias y contexto
                </p>
            </div>
        </div>
    </div>
</section>

<script>
// WSJF Calculator
function calculateWSJF() {
    const businessValue = parseInt(document.getElementById('businessValue').value);
    const urgency = parseInt(document.getElementById('urgency').value);
    const riskReduction = parseInt(document.getElementById('riskReduction').value);
    const effort = parseInt(document.getElementById('effort').value);
    
    // Update displays
    document.getElementById('businessValueDisplay').textContent = businessValue;
    document.getElementById('urgencyDisplay').textContent = urgency;
    document.getElementById('riskReductionDisplay').textContent = riskReduction;
    document.getElementById('effortDisplay').textContent = effort;
    
    // Calculate WSJF
    const numerator = businessValue + urgency + riskReduction;
    const wsjf = (numerator / effort);
    
    // Update formula displays
    document.getElementById('formulaBV').textContent = businessValue;
    document.getElementById('formulaU').textContent = urgency;
    document.getElementById('formulaRR').textContent = riskReduction;
    document.getElementById('formulaE').textContent = effort;
    document.getElementById('formulaSum').textContent = numerator;
    document.getElementById('formulaEffort').textContent = effort;
    document.getElementById('formulaResult').textContent = wsjf.toFixed(1);
    
    // Update result
    document.getElementById('wsjfResult').textContent = wsjf.toFixed(1);
    
    // Update interpretation
    let interpretation = '';
    if (wsjf >= 4) {
        interpretation = 'üî• Prioridad MUY ALTA - Incluir en pr√≥ximo sprint';
    } else if (wsjf >= 2.5) {
        interpretation = '‚ö° Prioridad ALTA - Considerar para pr√≥ximos 2 sprints';
    } else if (wsjf >= 1.5) {
        interpretation = 'üìã Prioridad MEDIA - Backlog prioritario';
    } else {
        interpretation = 'üîª Prioridad BAJA - Reconsiderar necesidad';
    }
    
    document.getElementById('wsjfInterpretation').textContent = interpretation;
}

// Initialize calculator
document.addEventListener('DOMContentLoaded', function() {
    // Add event listeners
    const inputs = ['businessValue', 'urgency', 'riskReduction', 'effort'];
    inputs.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener('input', calculateWSJF);
        }
    });
    
    calculateWSJF();
});
</script>